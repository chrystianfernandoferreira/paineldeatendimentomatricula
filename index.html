<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Painel ETEC - Harmonia Total</title>
    <style>
        /* Reset e Base */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body, html {
            width: 100%; 
            height: 100svh; /* Usa a altura real dispon√≠vel no mobile */
            background: #020617;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Segoe UI', Roboto, -apple-system, sans-serif;
            color: #ffffff; overflow: hidden;
        }

        .screen {
            display: flex; flex-direction: column; 
            width: 100vw; height: 100svh;
            background: linear-gradient(145deg, #7f1d1d, #111827);
            overflow: hidden;
        }

        /* CABE√áALHO: Prioridade visual 1 */
        .header { 
            flex: 2; /* Ocupa a maior parte da tela */
            background: rgba(153, 27, 27, 0.8);
            backdrop-filter: blur(10px);
            text-align: center; 
            display: flex; flex-direction: column; justify-content: center;
            padding: 1vh 2vw; 
            border-bottom: 4px solid #fde047; 
        }

        .header h1, .section h2 { 
            font-size: clamp(1rem, 4vh, 3rem); 
            text-transform: uppercase; 
            font-weight: 900; 
            letter-spacing: 1px;
            opacity: 0.9;
        }

        .senha-principal { 
            font-size: clamp(4rem, 28vh, 22rem); 
            font-weight: 900; color: #fde047; 
            line-height: 0.85; margin: 0.5vh 0;
            text-shadow: 0 10px 20px rgba(0,0,0,0.4); 
        }

        .setor-principal { 
            font-size: clamp(1.4rem, 7vh, 5.5rem); 
            font-weight: 800; text-transform: uppercase;
            color: #fff;
        }

        /* CONTE√öDO: Ret√¢ngulos Achatados e Proporcionais */
        .content { 
            flex: 0 0 auto; 
            height: 18vh; /* Altura controlada para n√£o empurrar o resto */
            display: flex; gap: 12px; padding: 12px; 
        }

        .section { 
            flex: 1; background: rgba(243, 244, 246, 0.95); 
            color: #111; border-radius: 12px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .info { 
            font-size: clamp(0.8rem, 3.2vh, 1.8rem); 
            font-weight: 700; 
            line-height: 1.2;
        }
        .info strong { color: #991b1b; }

        /* CONTROLES: Auto-ajuste para Mobile */
        .controls { 
            flex: 0 0 auto; 
            background: rgba(2, 6, 23, 0.9); 
            padding: 12px; 
            display: flex; justify-content: center; align-items: center;
            gap: 10px;
        }

        button {
            font-size: clamp(0.7rem, 1.8vh, 1.1rem); 
            padding: 12px 8px; border: none; border-radius: 8px; 
            cursor: pointer; font-weight: bold; 
            flex: 1; max-width: 200px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        button:active { transform: scale(0.95); }

        .doc { background: #dc2626; color: #fff; }
        .mat { background: #374151; color: #fff; }
        .reset { background: #eab308; color: #000; }

        /* RODAP√â: Otimizado para Mobile */
        .footer { 
            flex: 0 0 auto; background: #000; text-align: center; 
            padding: 10px 5px; 
            font-weight: 700; 
            font-size: clamp(0.65rem, 1.8vh, 1rem); 
            color: rgba(255,255,255,0.7);
            border-top: 1px solid #1e293b;
            letter-spacing: 0.3px;
        }

        /* Ajustes Mobile (Portrait) */
        @media (max-width: 600px) and (orientation: portrait) {
            .header { flex: 3; }
            .content { height: 28vh; flex-direction: column; gap: 8px; }
            .controls { padding: 8px; }
            button { padding: 10px 5px; min-width: 80px; }
            .footer { padding-bottom: 15px; } /* Espa√ßo extra para barras de navega√ß√£o mobile */
        }

        /* Anima√ß√£o */
        .piscar { animation: flash 0.6s ease-in-out 3; }
        @keyframes flash {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.02); color: #fff; }
        }
    </style>
</head>
<body>

<div class="screen">
    <div class="header">
        <h1>SENHA EM ATENDIMENTO:</h1>
        <div class="senha-principal" id="senha">--</div>
        <div class="setor-principal" id="setor">AGUARDANDO</div>
    </div>

    <div class="content">
        <div class="section">
            <h2>DOCUMENTA√á√ÉO</h2>
            <div class="info">Atendendo: <strong id="docAtual">--</strong></div>
            <div class="info">Pr√≥xima: <strong id="docProx">1</strong></div>
        </div>
        <div class="section">
            <h2>MATR√çCULA</h2>
            <div class="info">Atendendo: <strong id="matAtual">--</strong></div>
            <div class="info">Pr√≥xima: <strong id="matProx">1</strong></div>
        </div>
    </div>

    <div class="controls">
        <button class="doc" id="btnDoc">üìÑ Documenta√ß√£o</button>
        <button class="mat" id="btnMat">üìù Matr√≠cula</button>
        <button class="reset" id="btnReset">üîÑ Redefinir</button>
    </div>
    
    <div class="footer">Etec Sylvio de Mattos Carvalho ‚Ä¢ Centro Paula Souza</div>
</div>

<audio id="tindon" src="https://actions.google.com/sounds/v1/alarms/airport_chime.ogg" preload="auto"></audio>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, get, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCfaPNHgxrem88R7x8dKD9j2SzTYPm9v10",
        authDomain: "painel-senhas-etec.firebaseapp.com",
        databaseURL: "https://painel-senhas-etec-default-rtdb.firebaseio.com",
        projectId: "painel-senhas-etec",
        storageBucket: "painel-senhas-etec.appspot.com",
        messagingSenderId: "52328553080",
        appId: "1:52328553080:web:1fcdda82a6bdbf70732b8d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const estadoRef = ref(db, "estado");
    let lastTs = 0;

    function falar(s, set) {
        const el = document.getElementById('senha');
        el.classList.remove('piscar'); void el.offsetWidth; el.classList.add('piscar');
        const audio = document.getElementById('tindon');
        audio.play().catch(()=>{});
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const m = new SpeechSynthesisUtterance(`Senha ${s}, setor ${set}`);
            m.lang = "pt-BR"; m.rate = 1.1;
            window.speechSynthesis.speak(m);
        }
    }

    async function chamar(tipo) {
        const snap = await get(estadoRef);
        let d = snap.exists() ? snap.val() : { docAtual: "--", docProx: 1, matAtual: "--", matProx: 1 };
        let up = {};
        if (tipo === "DOCUMENTACAO") {
            up = { docAtual: d.docProx, senha: d.docProx, docProx: d.docProx + 1, setor: "DOCUMENTA√á√ÉO" };
        } else {
            up = { matAtual: d.matProx, senha: d.matProx, matProx: d.matProx + 1, setor: "MATR√çCULA" };
        }
        up.trigger = Date.now();
        await update(estadoRef, up);
    }

    onValue(estadoRef, (s) => {
        if (!s.exists()) return;
        const d = s.val();
        document.getElementById('senha').innerText = d.senha || "--";
        document.getElementById('setor').innerText = d.setor || "AGUARDANDO";
        document.getElementById('docAtual').innerText = d.docAtual || "--";
        document.getElementById('docProx').innerText = d.docProx || "1";
        document.getElementById('matAtual').innerText = d.matAtual || "--";
        document.getElementById('matProx').innerText = d.matProx || "1";
        if (d.trigger && d.trigger > lastTs) {
            lastTs = d.trigger;
            if (d.senha !== "--") falar(d.senha, d.setor);
        }
    });

    document.getElementById('btnDoc').onclick = () => chamar("DOCUMENTACAO");
    document.getElementById('btnMat').onclick = () => chamar("MATRICULA");
    document.getElementById('btnReset').onclick = async () => {
        if (confirm("Resetar?")) await set(estadoRef, { docAtual: "--", docProx: 1, matAtual: "--", matProx: 1, senha: "--", setor: "AGUARDANDO", trigger: 0 });
    };
</script>
</body>
</html>
